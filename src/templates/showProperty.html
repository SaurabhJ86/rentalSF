{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block content %}

<style type="text/css">
	#showVisitSuccessMessage,#showViistErrorMessage
	{
		display: none;
		position: absolute;
	}
</style>

<br>

{% if messages %}

	{% for message in messages %}

		<div class="alert alert-success">
			<strong><p align="center">{{ message }}</p></strong>
		</div>

	{% endfor  %}

{% endif %}

<div class="container">
	<div class="row">
		<div class="col-sm-6">
			<div class="card card-block">
				{% if get_object.property_image %}
					<div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
<!-- 						<ol class="carousel-indicators">
							<li data-target="#carouselExampleIndicators" data-slide="0" class="active"></li>
							<li data-target="#carouselExampleIndicators" data-slide="1"></li>
						</ol> -->
						<div class="carousel-inner">
							<div class="carousel-item active">
								<img class="card-img-top" src="{{ get_object.property_image.url }}">
							</div>
							<div class="carousel-item">
								<img class="card-img-top" src="{{ get_object.imagespropertylisting_set.all.0.image.url }}">
							</div>
							<div class="carousel-item">
								<img class="card-img-top" src="{{ get_object.imagespropertylisting_set.all.1.image.url }}">
							</div>
						</div>
						  <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
						    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
						    <span class="sr-only">Previous</span>
						  </a>
						  <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
						    <span class="carousel-control-next-icon" aria-hidden="true"></span>
						    <span class="sr-only">Next</span>
						  </a>
					</div>
				{% endif %}				
				<div class="card-body">
					<h5>{{ get_object.about_property}}</h4>
					<p>For {{ get_object.gender }} | {% if get_object.bed_available == 1 %} {{ get_object.bed_available }} bed available {% else %} {{ get_object.bed_available }} beds available {% endif %}</p>
					<p>{{ get_object.furnished }}</p>
				</div>
				<div class="card-body">
					<p>Features</p>
					<div class="container">
						<div class="row">
							<div class=" col-lg-4">
								<img src="https://img.icons8.com/ios/50/000000/sleeping-in-bed.png" alt="Images will be uploaded soon">
								<p>Bed</p>								 
							</div>
							<div class=" col-lg-4">
								<img src="https://img.icons8.com/ios/50/000000/shower-filled.png" alt="Images will be uploaded soon">
								<p>Bathroom</p>
							</div>
							<div class=" col-lg-4">
								<img src="https://img.icons8.com/ios/50/000000/sofa-with-buttons.png" alt="Images will be uploaded soon">
								<p>Fully Furnished</p>								
							</div>
						</div>
					</div>
				</div>
				<div class="card-body">
					<div class="container">
						<div class="row">
							<div class="col-lg-12">
								{% for feature in get_object.get_features %}
									<ul>
										<li>{{ feature }}</li>
									</ul>
								{% endfor %}
							</div>
						</div>
					</div>
				</div>
				<div class="card-body">
					<div class="container">
						<div class="row">
							<div class="col-sm-12">
								{% if get_object.offer %}
									<p>Offers</p>
									{% for offer in get_object.get_offers %}
										<ul>
											<li>{{ offer }}</li>
										</ul>
									{% endfor %}
								{% endif %}								
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="col-sm-4 offset-sm-2">
			<button class="btn btn-info" id="schedulevist" data-toggle="modal" data-target="#scheduleVistModal">Schedule a Visit</button>
		</div>
	</div>
</div>

<div id="scheduleVistModal" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<div class="alert alert-success" id="showVisitSuccessMessage">
  					<strong>Success!</strong> Details have been recevied successfully.
				</div>
				<div class="alert alert-danger" id="showViistErrorMessage">
  					<strong>Error!</strong> Something wrong happened. Please try after later.
				</div>
				<h5 align="center">Please share your contact details</h5>
			</div>
			<div class="modal-body">
				<form  style="text-align: center;" method="POST">{% csrf_token %}
					{{ visitForm|crispy }}
					<br>
					<button class="btn btn-primary" id="SubmitVisitForm" type="submit">Submit</button>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<br>
<div class="container">
	<div class="row">
		<div class="col-sm-6">
			<div class="card text-center">
				<div class="card-header">
					<ul class="nav nav-tabs card-header-tabs">
						<li class="nav-item">
							<a class="nav-link active" href="#">{{ get_object.room_type|capfirst }}</a>
						</li>
					</ul>
				</div>
				<div class="card card-body">
					<div class="card-body">
						<div class="container">
							<div class="row">
								<div class="col-sm-4">
									<p style="float: left;">Rent</p>
								</div>
								<div class="col-sm-4 offset-sm-4">
									<p>{{ get_object.rent }}</p>
								</div>
							</div>
						</div>
					</div>
					<div class="card-body">
						<div class="container">
							<div class="row">
								<div class="col-sm-9">
									<p style="float: left;">Security Deposit</p><br>
									<p style="float: left;"><font size="2">Fully refundable if maintained in original condition.</font></p>
								</div>
								<div class="col-sm-2">
									<p>{{ get_object.deposit }}</p>
								</div>
							</div>					
						</div>
					</div>
					<div class="card-body">
						<div class="container">
							<div class="row">
								<div class="col-sm-9">
									<p style="float: left;">Extra Charges</p><br>
									<p style="float: left;"><font size="2">One-time charges. For all legal requirements.</font></p>
								</div>
								<div class="col-sm-2">
									<p>2000</p>
								</div>
							</div>								
						</div>
					</div>
					<div class="card-body">
						<div class="container">
							<p><strong style="float: left;">Rent Excludes</strong>: Food, Utilities and Other Miscellaneous living expenses</p>	
						</div>
						
					</div>
				</div>				
			</div>
		</div>
	</div>
</div>

<br>
<br>


<br>

<div class="container">
	<div class="row">
		<div class="col-sm-6">
			<div class="card text-center">
				<div class="card-body">
					<h5 class="card-title">Terms of Stay</h5>
				</div>
			</div>
		</div>
	</div>
</div>

<br>
<br>

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript">
	$(document).ready(function(){
		var carousel_click = 0
		$("#showVisitSuccessMessage").hide()
		$("#SubmitVisitForm").on("click",function(e){
			e.preventDefault()
			var name = $("#id_name").val()
			var contact = $("#id_contact").val()
			var email = $("#id_email").val()
			$.ajax({
				type:"POST",
				url:"{{ get_object.get_absolute_url }}",
				data:{
					csrfmiddlewaretoken:"{{ csrf_token }}",
					"name":name,
					"contact":contact,
					"email":email,
					"visit":true,
				},
				success:function(context){
					if (context == "Received_Contact_Details")
					{
						$("#showVisitSuccessMessage").fadeIn()
						setTimeout(function(){
							$("#showVisitSuccessMessage").fadeOut()
						},5000)
					}
					if (context == "Error_Received")
					{
						$("#showViistErrorMessage").fadeIn()
						setTimeout(function(){
							$("#showViistErrorMessage").fadeOut()
						},5000)						
					}
				}
			})
		})
		$("#carouselExampleIndicators").on("slid.bs.carousel",function(e){
			// console.log("{{ get_object.imagespropertylisting_set.all.0.image.url }}".replace("0",carousel_click))
			// $(".carousel-item active").attr("src","get_object.imagespropertylisting_set.all." + String(carousel_click) + ".media.url")
			carousel_click += 1
			console.log(carousel_click)
			// console.log(carousel_click)
			// {% for img in get_object.imagespropertylisting_set.all %}
			// 	console.log("{{img}}")
			// {% endfor %}
		})
	})
</script>

{% endblock %}